
#messages
  #message-view
    ol.messages
      for message in messages
        li(id='#{message.key}', class='message-root')
          a(href='javascript:;', data-action='view')
            img(src='#{message.avatar}', class='avatar', data-action='view')
            span(data-action='view')= message.name

  #message-detail
    p
      span
    canvas(id='dither-view', class='hidden')
    a(href='javascript:;', data-action='reply', class='actions reply') Reply
    a(href='javascript:;', data-action='close', class='actions close') Close
    .countdown 10

  form(method='post', id='message-form')
    textarea(name='message', placeholder='write your message (maximum 200 characters)')
    textarea(name='photo_message')
    canvas(id='dither-preview', class='hidden')
    input(type='file', name='photo', accept='image/*')
    input(type='hidden', name='width', id='image-width')
    input(type='hidden', name='height', id='image-height')
    .dither-toggle
      label(for='dither', class='checkbox')
        = 'Dither photo'
        input(type='checkbox', name='dither', data-action='dither')Ã¥
    input(type='hidden', name='email')
    input(type='hidden', value='#{session._csrf}', name='_csrf')
    span(id='current-contact')
    .button-wrapper
      button(data-action='upload-photo', class='selectors', type='button') upload a photo
      button(data-action='contacts', class='selectors', type='button') choose a contact
    ol#contacts
    #message-status
    button(type='submit') Send
    a(href='javascript:;', data-action='cancel', class='cancel') Cancel

  form(method='post', id='contacts-form')
    h2 Add a new contact
    p.tip Contacts will receive notifications only if they sign in and set it. So let them know the first time!
    input(type='text', name='email', placeholder='add contact email')
    input(type='hidden', value='#{session._csrf}', name='_csrf')
    #contact-status
    button(type='submit') Add

  form(method='post', id='email-notification-form')
    if session.emailNotification
      input(type='checkbox', name='emailNotification', checked='checked')
    else
      input(type='checkbox', name='emailNotification')
    h2 Email notifications?
    input(type='hidden', value='#{session._csrf}', name='_csrf')
    #email-notification-status
    button(type='submit') Update

  form(method='post', id='api-form')
    h2 Add/reset your Pushover API Key
    p.tip Register for push notifications at
      a(href='https://pushover.net', target='_blank')  pushover.net
    input(type='text', name='apiKey', placeholder='add a notfication api key', value='#{session.apiKey || ""}')
    input(type='hidden', value='#{session._csrf}', name='_csrf')
    #api-status
    button(type='submit') Update
    a(href='javascript:;', data-action='cancel', class='cancel') Close

  #footer
    a(href='javascript:;', data-action='new-message') Message
    a(href='javascript:;', data-action='add-contact-form') Settings
    a(href='javascript:;', data-action='logout', id='logout') Sign out
